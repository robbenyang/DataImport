Kevin	 Â C.	 Â Chang
Map Â Reduce
Database	 Â Systems
1
	 Â 
All	 Â the	 Â way	 Â through	 Â non	 Â relational	 Â data,	 Â 
now	 Â this	 Â is	 Â the	 Â time	 Â for	 Â mapreduce!	 Â 
â€¢ Why	 Â MapReduce?
â€¢ Scenarios	 Â where	 Â MapReduce may	 Â excel.
â€¢ MapReduce abstraction.
â€¢ MapReduce architecture.
â€¢ Is	 Â MapReduce better,	 Â or	 Â not?	 Â Where	 Â and	 Â why?
Concepts	 Â You	 Â Will	 Â Learn
Map	 Â Reduce	 Â (1	 Â of	 Â 44)Default	 Â Section	 Â (1	 Â of	 Â 2)
	 Â 
	 Â 
The Â Big Â Picture: Â Where Â We Â Are
Map Â Reduce Â (2 Â of Â 44)Default Â Section Â (2 Â of Â 2)
Data	 Â Access
Data	 Â Modeling
Data/Query	 Â Processing
Data	 Â Acquisition
Relational NonRelational
St
ru
ct
ur
ed
Se
m
iS
tr
uc
tu
re
d
Transaction	 Â Management
N
oS
Q
L Â 
D
at
ab
as
es
XM
L Â 
D
at
ab
as
es
U
nt
ru
ct
ur
ed
Relational Â Databases
â€¢ SQL
â€¢ Relational Â Algebra
â€¢ Query Â Optimization
â€¢ Query Â Execution
â€¢ Indexing
â€¢ Concurrency Â Control
â€¢ Logging Â Recovery
Database Â Systems Toolkits
M
ap
 Â R
ed
uc
e
(P
ar
al
le
l)
St
or
m
 Â 
(S
tr
ea
m
)
Information Â Extraction
ER Â Ã ïƒ  Relational Â Model
Query	 Â Language
	 Â 
So	 Â far,	 Â we	 Â have	 Â studied	 Â relational	 Â algebra,	 Â 
XML	 Â databases,	 Â NOSQL	 Â databases,	 Â query	 Â 
processing,	 Â query	 Â optimization	 Â and	 Â so	 Â on.	 Â 
However,	 Â these	 Â are	 Â not	 Â sufficient.	 Â There	 Â 
is	 Â a	 Â kind	 Â of	 Â scenario	 Â when	 Â we	 Â are	 Â dealing	 Â 
with	 Â non-Â­â€relational	 Â data	 Â but	 Â we	 Â still	 Â have	 Â 
to	 Â process	 Â data	 Â just	 Â like	 Â the	 Â way	 Â we	 Â join	 Â 
and	 Â project.	 Â So	 Â we	 Â introduce	 Â map-Â­â€reduce.	 Â 	 Â 
Why	 Â Do	 Â We	 Â Learn	 Â This?
Map Â Reduce Â (3 Â of Â 44)Why Â Do Â We Â Learn Â This? Â (0 Â of Â 7)
	 Â 
There	 Â are	 Â many	 Â reasons	 Â to	 Â use	 Â 
mapreduce.	 Â To	 Â learn	 Â the	 Â basic	 Â idea	 Â of	 Â 
mapreduce,	 Â you	 Â can	 Â view	 Â this	 Â link	 Â 
http://en.wikipedia.org/wiki/MapReduce
or	 Â go	 Â on	 Â reading	 Â next	 Â pages.	 Â 
Big Â Data, Â Again!
Map Â Reduce Â (4 Â of Â 44)Why Â Do Â We Â Learn Â This? Â (1 Â of Â 7)
People Â and Â brands Â on Twitter send Â 
more Â than 340	 Â million	 Â tweets a Â day.
People Â upload 72	 Â hours	 Â (259,200	 Â 
seconds) of Â new Â video Â to YouTube a Â 
minute.
Google receives Â over 2	 Â million	 Â 
search	 Â queries a Â minute.
	 Â 
Data	 Â is	 Â everywhere.	 Â Huge	 Â data	 Â flow	 Â is	 Â 
everywhere,	 Â thus	 Â a	 Â need	 Â for	 Â big	 Â data	 Â 
decomposition	 Â method	 Â is	 Â needed.	 Â 
The	 Â definition	 Â and	 Â brief	 Â introduction	 Â to	 Â 
big	 Â data:	 Â 
http://en.wikipedia.org/wiki/Big_data	 Â 
	 Â 
â€¢ Data	 Â is	 Â distributed	 Â in	 Â multiple	 Â computers.
â€¢ Logically	 Â a	 Â single	 Â machine
â€¢ Featuring	 Â well-Â­â€defined	 Â schemas,	 Â declarative	 Â query	 Â 
languages	 Â (SQL).
â€¢ Have	 Â been	 Â studied	 Â for	 Â decades.
Traditional	 Â Solution	 Â for	 Â Big	 Â Data:
Parallel	 Â Database
Map	 Â Reduce	 Â (5	 Â of	 Â 44)Why	 Â Do	 Â We	 Â Learn	 Â This?	 Â (2	 Â of	 Â 7)
SQL
Relational	 Â 
Data
	 Â 
Use	 Â SQL	 Â as	 Â primary	 Â way	 Â to	 Â store	 Â big	 Â data	 Â 
in	 Â multi	 Â computers	 Â traditionallyâ€¦	 Â 
More	 Â information	 Â and	 Â definition	 Â about	 Â 
parallel	 Â database:	 Â 
http://en.wikipedia.org/wiki/Parallel_dat
abase	 Â 
Example:	 Â when	 Â we	 Â do	 Â beers	 Â join	 Â sells,	 Â we	 Â 
can	 Â do	 Â it	 Â on	 Â ten	 Â computers.	 Â 
Parallel Â database Â is Â powerful Â in Â supporting Â SQL Â 
queries Â on Â big Â data.
Map Â Reduce Â (6 Â of Â 44)Why Â Do Â We Â Learn Â This? Â (3 Â of Â 7)
But	 Â ...
	 Â 
There	 Â are	 Â scenarios	 Â that	 Â parallel	 Â database	 Â 
is	 Â not	 Â sufficient.	 Â Mapreduce	 Â and	 Â other	 Â no	 Â 
sql	 Â database	 Â become	 Â new	 Â ways	 Â to	 Â solve	 Â 
several	 Â dilemmas	 Â relational	 Â database	 Â is	 Â 
lacking	 Â capability	 Â of.	 Â 	 Â 
â€¢ A	 Â lot	 Â of	 Â Web	 Â data	 Â are	 Â semi-Â­â€structured	 Â without	 Â 
predefined	 Â schema.
Scenario	 Â 1:	 Â Semi-Â­â€Structured	 Â Data
Map	 Â Reduce	 Â (7	 Â of	 Â 44)Why	 Â Do	 Â We	 Â Learn	 Â This?	 Â (4	 Â of	 Â 7)
Inconsistent	 Â with	 Â relational	 Â model	 Â in	 Â RDBMS	 Â 
	 Â 
First:	 Â Use	 Â key-Â­â€value	 Â pairs	 Â in	 Â JSON	 Â or	 Â XML	 Â 
or	 Â other	 Â semi-Â­â€structured	 Â data.	 Â 
See	 Â more	 Â in	 Â previous	 Â semi-Â­â€structure	 Â 
database	 Â slides	 Â for	 Â a	 Â review.	 Â 
Scenario Â 2: Â ETL Â (Extraction, Â Transform Â and Â Load) Â 
and Â â€œread Â onceâ€ Â Tasks
Map Â Reduce Â (8 Â of Â 44)Why Â Do Â We Â Learn Â This? Â (5 Â of Â 7)
Example: Web	 Â Logs Processing
Web	 Â Logs
It	 Â is	 Â unnecessary	 Â to	 Â store	 Â data	 Â 	 Â in	 Â DBMS	 Â for	 Â 
querying.
Counting	 Â Word	 Â Distribution
Aggregated	 Â by	 Â Users
Trend	 Â Analysis
Useful	 Â 
Statistics
	 Â 
ETL:	 Â load	 Â ,extract,	 Â and	 Â transform	 Â data,	 Â a	 Â 
work	 Â flow	 Â before	 Â SQL	 Â database.	 Â As	 Â 
second	 Â scenario.	 Â 	 Â 	 Â 
http://en.wikipedia.org/wiki/Extract,_tra
nsform,_load	 Â 
Scenario Â 3: Â Data Â Mining Â Applications
Map Â Reduce Â (9 Â of Â 44)Why Â Do Â We Â Learn Â This? Â (6 Â of Â 7)
Data
Initial Â 
Assignment Â 
of Â Clusters
Find Â 
Cluster Â 
Center
Reassign Â 
Data
...
Could	 Â not	 Â be	 Â structured	 Â as	 Â single	 Â SQL	 Â queries.
Example: K-Â­â€Means
	 Â 
For	 Â data	 Â mining	 Â purposes.	 Â Complex	 Â 
operation	 Â far	 Â beyond	 Â the	 Â Greek	 Â symbols	 Â 
(RA	 Â query)	 Â 
Scenario Â 4: Â Limited-Â­â€budge Â and Â Robust Â 
Map Â Reduce Â (10 Â of Â 44)Why Â Do Â We Â Learn Â This? Â (7 Â of Â 7)
â€¢ Open	 Â source	 Â distributed Â database Â 
systems Â are Â not	 Â robust	 Â enough
â€¢ Commercial distributed Â database Â 
systems Â are Â expensive
	 Â 
Really	 Â expensive	 Â traditional	 Â database.	 Â 
Long	 Â work	 Â flow:	 Â transaction	 Â semantic	 Â 
with	 Â no	 Â partial	 Â result.	 Â 
All	 Â of	 Â them	 Â are	 Â shortcomings	 Â of	 Â SQL.	 Â 
What	 Â is	 Â MapReduce?
Map Â Reduce Â (11 Â of Â 44)What Â is Â MapReduce? Â (0 Â of Â 3)
	 Â 
	 Â 
â€¢ A	 Â Programming	 Â model	 Â for	 Â large-Â­â€scale	 Â distributed	 Â 
data	 Â processing
â€¢ History
â€¢ The	 Â actual	 Â origins	 Â of	 Â Mapreduce are	 Â arguable,	 Â but	 Â the	 Â 
paper	 Â which	 Â is	 Â most	 Â cited	 Â is	 Â â€œMapReduce:	 Â Simplified	 Â Data	 Â 
Processing	 Â on	 Â Large	 Â Clustersâ€ by	 Â Jeffrey	 Â Dean	 Â and	 Â Sanjay	 Â 
Ghemawat in	 Â 2004
â€¢ Pioneer	 Â of	 Â MapReduce implementation:	 Â Hadoop
Framework	 Â by	 Â Doug	 Â Cutting	 Â and	 Â â€¦
â€¢ Today,	 Â numerous	 Â independent	 Â people	 Â and	 Â organizations	 Â 
contribute	 Â to	 Â MapReduce Project
What	 Â is	 Â MapReduce?
Map	 Â Reduce	 Â (12	 Â of	 Â 44)What	 Â is	 Â MapReduce?	 Â (1	 Â of	 Â 3)
	 Â 
Map-Â­â€reduce	 Â history	 Â 
â€¢ â€œGooglersâ€™	 Â Hammer	 Â for	 Â 80%	 Â of	 Â our
Data	 Â crunchingâ€
â€¢ Large	 Â scale	 Â web	 Â search	 Â indexing
â€¢ Clustering	 Â problems	 Â for	 Â Google	 Â News
â€¢ Produce	 Â reports	 Â for	 Â 	 Â popular	 Â queries
â€¢ Large-Â­â€scale	 Â machine	 Â learning	 Â problems.
â€¢ ...
MapReduce in	 Â Google
Map	 Â Reduce	 Â (13	 Â of	 Â 44)What	 Â is	 Â MapReduce?	 Â (2	 Â of	 Â 3)
	 Â 
Wide	 Â range	 Â of	 Â usage	 Â of	 Â Mapreduce	 Â in	 Â 
Googleâ€™s	 Â applications.	 Â 
â€¢ Google	 Â MapReduce
â€¢ Support	 Â C++,	 Â Java,	 Â Python,	 Â Sawzall,	 Â ...
â€¢ Based	 Â on	 Â Proprietary	 Â infrastructres
â€¢ GFS,	 Â Sawzall,	 Â Chubby,	 Â BigTable
â€¢ And	 Â some	 Â open	 Â source	 Â libraries
â€¢ Hadoop Map-Â­â€Reduce
â€¢ Open	 Â Source	 Â (Kudos	 Â to	 Â Doug	 Â and	 Â the	 Â team)
â€¢ Plus	 Â the	 Â whole	 Â equivalent	 Â package,	 Â and	 Â more
â€¢ HDFS,	 Â Map-Â­â€Reduce,	 Â Pig,	 Â Zookeeper,	 Â Hbase,	 Â Hive
â€¢ Used	 Â by	 Â Yahoo!,	 Â Facebook,	 Â Amazon,	 Â ...
â€¢ Dryad
â€¢ Proprietary,	 Â based	 Â on	 Â Microsoft	 Â SQL	 Â Servers
â€¢ Dyrad,	 Â DyradLINQ
Existing	 Â MapReduce and	 Â Similar	 Â Systems
Map	 Â Reduce	 Â (14	 Â of	 Â 44)What	 Â is	 Â MapReduce?	 Â (3	 Â of	 Â 3)
	 Â 
Some	 Â examples	 Â of	 Â mapreduce	 Â 
applications.	 Â 	 Â 
For	 Â example,	 Â Hadoop:	 Â 
http://en.wikipedia.org/wiki/Apache_Had
oop	 Â 
MapReduce	 Â Abstraction
Map Â Reduce Â (15 Â of Â 44)MapReduce Â Abstraction Â (0 Â of Â 9)
	 Â 
	 Â 
â€¢ Many	 Â tasks	 Â are	 Â composed	 Â of	 Â a	 Â Map	 Â procedure	 Â and	 Â a	 Â 
Reduce	 Â procedure
â€¢ Map:	 Â Categorize	 Â the	 Â data.
â€¢ Reduce:	 Â Aggregate	 Â the	 Â data.
â€¢ Ex:	 Â Counting	 Â Number	 Â of	 Â Keywords	 Â in	 Â Text	 Â Corpus
â€¢ Map:	 Â Categorize	 Â the	 Â keyword	 Â occurrence	 Â by	 Â its	 Â content.
â€¢ Reduce:	 Â Count	 Â the	 Â number	 Â of	 Â occurrences	 Â of	 Â each	 Â keyword
Intuition	 Â behind	 Â MapReduce
Map	 Â Reduce	 Â (16	 Â of	 Â 44)MapReduce	 Â Abstraction	 Â (1	 Â of	 Â 9)
	 Â 
Map	 Â and	 Â reduce	 Â are	 Â derived	 Â from	 Â 
functional	 Â language	 Â such	 Â as	 Â list,	 Â where	 Â we	 Â 
always	 Â work	 Â on	 Â a	 Â list	 Â of	 Â values,	 Â apply	 Â a	 Â 
function	 Â that	 Â is	 Â called	 Â map,	 Â then	 Â sum	 Â up	 Â 
to	 Â generates	 Â some	 Â aggregate,	 Â called	 Â 
reduce.	 Â 
Two	 Â operators	 Â in	 Â MapReduce:	 Â map	 Â and	 Â 
reduce,	 Â take	 Â user	 Â defined	 Â function,	 Â thatâ€™s	 Â 
the	 Â reason	 Â why	 Â mapreduce	 Â is	 Â so	 Â 
powerful.	 Â 
MapReduce Framework
Map Â Reduce Â (17 Â of Â 44)MapReduce Â Abstraction Â (2 Â of Â 9)
Data
Map():	 Â Categorize Â the Â 
data Â to Â re-Â­â€distribute Â the Â 
workload.
Reduce():	 Â Aggregate Â the Â 
Categorized Â data
	 Â 
In	 Â WordCount()	 Â example,	 Â map	 Â will	 Â take	 Â 
each	 Â document,	 Â categorize	 Â the	 Â keyword	 Â 
occurrence	 Â by	 Â its	 Â content,	 Â generate	 Â 
output	 Â <key,..>.	 Â Reduce	 Â will	 Â sum	 Â up	 Â the	 Â 
number	 Â of	 Â occurrences	 Â of	 Â each	 Â keyword.	 Â 
â€¢ Problem:	 Â Counting	 Â the	 Â frequency	 Â of	 Â each	 Â keyword.
â€¢ Input:	 Â List	 Â of	 Â documents.
â€¢ Output:	 Â <Keyword_1,	 Â Frequency_1>,	 Â <Keyword_2,	 Â 
Frequency_2>,	 Â ...
Use	 Â WordCount()	 Â as	 Â Example
Map	 Â Reduce	 Â (18	 Â of	 Â 44)MapReduce	 Â Abstraction	 Â (3	 Â of	 Â 9)
	 Â 
Map	 Â will	 Â generate	 Â output	 Â <keyword,	 Â 
frequency>,	 Â e.g.	 Â 
<â€dataâ€,12312>	 Â 
<â€queryâ€,3231>	 Â 
Example: Â Map() Â in Â WordCount()
Map Â Reduce Â (19 Â of Â 44)MapReduce Â Abstraction Â (4 Â of Â 9)
Map()ğ¾ğ‘’ğ‘¦, ğ‘‰ğ‘ğ‘™ List(ğ¾ğ‘’ğ‘¦(, Â ğ‘‰ğ‘ğ‘™()
Abstraction Â of Â Map()
Map()
Doc0, Â â€œA Â bad Â 
beginning Â 
makes Â a Â bad Â 
endingâ€. Â  Â 
[<â€œaâ€, Â 1>,
<â€œbadâ€, Â 2>,
<â€œmakesâ€, Â 1>,
<â€œendingâ€, Â 1> Â 
...]
	 Â 
Map	 Â transforms	 Â key-Â­â€value	 Â pairs	 Â into	 Â a	 Â list	 Â 
of	 Â key-Â­â€value	 Â pairs.	 Â 
The	 Â key	 Â for	 Â input	 Â is	 Â Doc0,	 Â and	 Â the	 Â key	 Â for	 Â 
output	 Â is	 Â the	 Â word,	 Â the	 Â output	 Â is	 Â also	 Â key-Â­â€
value	 Â paired.	 Â 
Can	 Â even	 Â have	 Â multi	 Â level	 Â maps.	 Â (See	 Â 
next)	 Â 
	 Â 
Abstraction Â of Â Reduce()
Map Â Reduce Â (20 Â of Â 44)MapReduce Â Abstraction Â (5 Â of Â 9)
Example: Â Reduce() Â in Â WordCount()
Reduce()
ğ¾ğ‘¦ğ‘’$,ğ¿ğ‘–ğ‘ ğ‘¡(ğ‘‰ğ‘ğ‘™$) ğ¾ğ‘¦ğ‘’$, ğ‘‰ğ‘ğ‘™$â€²
Reduce()
â€œbadâ€, Â 
[2,1,1,1] â€œbadâ€, Â 5 Â 
	 Â 
Reduce	 Â part	 Â will	 Â take	 Â the	 Â value	 Â of	 Â same	 Â 
key,	 Â merge	 Â them	 Â together	 Â (e.g.,	 Â sum	 Â the	 Â 
value	 Â up)	 Â to	 Â get	 Â final	 Â key-Â­â€value	 Â results.	 Â 
Again	 Â the	 Â output	 Â is	 Â key-Â­â€value	 Â paired.	 Â 
Both	 Â the	 Â key	 Â of	 Â input	 Â and	 Â output	 Â is	 Â word.	 Â 
Workflow Â of Â WordCount()
Map Â Reduce Â (21 Â of Â 44)MapReduce Â Abstraction Â (6 Â of Â 9)
Data
â€œA	 Â bad	 Â beginning	 Â 
makes	 Â a	 Â bad	 Â endingâ€.	 Â  â€I	 Â have	 Â a	 Â bad	 Â news.â€
<â€œbadâ€,	 Â 3> <â€œaâ€,	 Â 3>
<â€œbadâ€, Â 2>
<â€œaâ€, Â 2> <â€œbadâ€, Â 1><â€œaâ€, Â 1>
Map	 Â Phase
Reduce	 Â Phase
	 Â 
Visual	 Â flow	 Â of	 Â data	 Â in	 Â mapreduce	 Â :	 Â 
Have	 Â two	 Â documents.	 Â Do	 Â parallel	 Â 
mappers,	 Â the	 Â first	 Â document	 Â go	 Â to	 Â one	 Â 
mapper,	 Â the	 Â other	 Â go	 Â to	 Â another.	 Â And	 Â 
send	 Â same	 Â words	 Â to	 Â the	 Â same	 Â reducer	 Â 
(Done	 Â by	 Â MapReduce	 Â framework).	 Â The	 Â 
reducer	 Â will	 Â sum	 Â up	 Â the	 Â value.	 Â 
â€¢ Problem:	 Â Compute	 Â average	 Â income	 Â in	 Â a	 Â city	 Â for	 Â a	 Â 
given	 Â year	 Â (e.g.,	 Â 2007)
â€¢ Input:
â€¢ Personal	 Â Information:	 Â <SSN,	 Â Personal	 Â Info>
â€¢ E.g.	 Â <â€œ12345â€,	 Â {John	 Â Smith,	 Â Sunnyvale,	 Â CA}>
â€¢ Income	 Â Information:	 Â <SSN,	 Â {year,	 Â income}>
â€¢ E.g.	 Â <â€œ12345â€,	 Â {2007,	 Â $72000}>,	 Â <â€œ98765â€,	 Â {2013,	 Â $12344}>
â€¢ Output:	 Â Average	 Â income	 Â in	 Â each	 Â city	 Â in	 Â 2007
â€¢ E.g.	 Â <Sunnyvale,	 Â 12000>,	 Â <Champaign,	 Â 2000>,	 Â ...
Example	 Â 2:	 Â Average	 Â Income
Map	 Â Reduce	 Â (22	 Â of	 Â 44)MapReduce	 Â Abstraction	 Â (7	 Â of	 Â 9)
Example	 Â From	 Â 	 Â Zhao	 Â et	 Â al.	 Â :â€MapReduce:	 Â The	 Â Programming	 Â Model	 Â and	 Â Practiceâ€
	 Â 
A	 Â multi	 Â level	 Â example	 Â of	 Â mapreduce.	 Â 
This	 Â time	 Â we	 Â create	 Â two	 Â types	 Â of	 Â key-Â­â€
value	 Â pairs.	 Â 
See	 Â solution	 Â in	 Â next-Â­â€>next	 Â slide!	 Â 
How Â to Â Design Â Map() Â & Â Reduce()?
Map Â Reduce Â (23 Â of Â 44)MapReduce Â Abstraction Â (8 Â of Â 9)
	 Â 
	 Â 
Solution
Map Â Reduce Â (24 Â of Â 44)MapReduce Â Abstraction Â (9 Â of Â 9)
	 Â 
In	 Â mapper	 Â 1a,	 Â we	 Â project	 Â SSN,	 Â city.	 Â 
In	 Â mapper	 Â 1b,	 Â we	 Â project	 Â SSN,	 Â 2007	 Â 
income	 Â 
In	 Â reducer	 Â 1,	 Â same	 Â SSN	 Â come	 Â together,	 Â 
and	 Â do	 Â a	 Â join.	 Â 
In	 Â mapper	 Â 2,	 Â use	 Â SSN	 Â as	 Â a	 Â key,	 Â project	 Â city	 Â 
2007	 Â income	 Â 
In	 Â reducer	 Â 2,	 Â use	 Â city	 Â as	 Â a	 Â key,	 Â do	 Â the	 Â 
aggregate,	 Â calculate	 Â the	 Â average	 Â 
Bad	 Â example:	 Â data	 Â &	 Â operation	 Â is	 Â already	 Â 
relational	 Â so	 Â donâ€™t	 Â need	 Â Map	 Â Reduce,	 Â can	 Â 
just	 Â use	 Â Relational	 Â Operators.	 Â 
	 Â 
MapReduce	 Â Architecture
Map Â Reduce Â (25 Â of Â 44)MapReduce Â Architecture Â (0 Â of Â 8)
	 Â 
	 Â 
Map Â Reduce Â Architecture
Map Â Reduce Â (26 Â of Â 44)MapReduce Â Architecture Â (1 Â of Â 8)
	 Â 
There	 Â are	 Â concrete	 Â slides	 Â of	 Â steps	 Â in	 Â the	 Â 
following	 Â 6	 Â slides.	 Â 
So	 Â for	 Â the	 Â whole	 Â framework,	 Â 	 Â 
1. It	 Â will	 Â fork(know	 Â how	 Â much	 Â 
resource	 Â you	 Â have)	 Â 
2. Move	 Â the	 Â data	 Â 	 Â 
3. Assign	 Â mapped	 Â function,	 Â assign	 Â 
reduce	 Â worker	 Â 
4. Generate	 Â the	 Â reduce	 Â worker,	 Â do	 Â 
all	 Â this	 Â communication	 Â issue	 Â 
As	 Â a	 Â programmer,	 Â we	 Â need	 Â to	 Â 
1. Prepare	 Â the	 Â data	 Â 
2. Give	 Â a	 Â map	 Â function	 Â and	 Â 
3. Give	 Â a	 Â reduce	 Â function	 Â 
	 Â 
How	 Â do	 Â we	 Â benefit	 Â from	 Â this	 Â framework?	 Â 
It	 Â immediately	 Â makes	 Â the	 Â cluster	 Â of	 Â nodes	 Â 
available	 Â to	 Â us.	 Â It	 Â worries	 Â about	 Â the	 Â 
scheduling	 Â issue	 Â and	 Â make	 Â it	 Â transparent	 Â 
to	 Â us.	 Â 
	 Â 
(0) Â Shards the Â input Â file.
Map Â Reduce Â (27 Â of Â 44)MapReduce Â Architecture Â (2 Â of Â 8)
A Â bad Â beginning Â 
makes Â a Â bad Â ending
I Â have Â a Â 
bad Â news
Each Â shard Â is Â typically Â 
16~64MB Â in Â size.
	 Â 
First	 Â phase:	 Â partition	 Â the	 Â documents	 Â by	 Â 
the	 Â framework	 Â 
	 Â 
(1) Â The Â user Â program Â creates	 Â processes	 Â on Â 
the Â Master Â and Â worker Â threads.
Map Â Reduce Â (28 Â of Â 44)MapReduce Â Architecture Â (3 Â of Â 8)
A Â bad Â beginning Â 
makes Â a Â bad Â ending
I Â have Â a Â 
bad Â news
	 Â 
What	 Â a	 Â user	 Â of	 Â this	 Â framework	 Â needs	 Â to	 Â 
do:	 Â 
-Â­â€-Â­â€Prepare	 Â data,	 Â map	 Â function	 Â and	 Â reduce	 Â 
function	 Â 
(2) Â Master Â pick Â idle Â workers Â to Â assignmap Â 
or Â reduce Â tasks
Map Â Reduce Â (29 Â of Â 44)MapReduce Â Architecture Â (4 Â of Â 8)
A Â bad Â beginning Â 
makes Â a Â bad Â ending
I Â have Â a Â 
bad Â news
	 Â 
	 Â 
(3) Â Each Â mapworker Â reads Â assigned Â input Â 
shard Â and Â output Â <key, Â value> Â pairs.
Map Â Reduce Â (30 Â of Â 44)MapReduce Â Architecture Â (5 Â of Â 8)
<bad, Â 2>
<a, Â 1>
<ending, Â 1>
...
<bad, Â 1>
<a, Â 1>
<news, Â 1>
...
A Â bad Â beginning Â 
makes Â a Â bad Â ending
I Â have Â a Â 
bad Â news
	 Â 
-Â­â€-Â­â€Second	 Â phase:	 Â documents	 Â fed	 Â into	 Â 
worker	 Â to	 Â map,	 Â outputting	 Â key-Â­â€value	 Â pairs	 Â 
(4) Â Write Intermediate Â <key, Â value> pairs Â to Â 
local Â disk.
Map Â Reduce Â (31 Â of Â 44)MapReduce Â Architecture Â (6 Â of Â 8)
<bad, Â 2>
<a, Â 1>
<ending, Â 1>
...
<bad, Â 1>
<a, Â 1>
<news, Â 1>
...
	 Â 
	 Â 
(5) Â Reduceworker Â reads Â intermediate Â data Â 
sort Â by Â key
Map Â Reduce Â (32 Â of Â 44)MapReduce Â Architecture Â (7 Â of Â 8)
<bad, Â 2>
<a, Â 1>
<ending, Â 1>
...
<bad, Â 1>
<a, Â 1>
<news, Â 1>
...
<bad, Â (2, Â 1)>
<ending, Â 1>
...
<a, Â (1, Â 1)>
<news, Â 1>
...
	 Â 
Third	 Â phase:	 Â reduce.	 Â Pairs	 Â of	 Â same	 Â keys	 Â 
go	 Â to	 Â same	 Â reducer	 Â 
	 Â 
(6) Â Reduce Â workers Â write the Â result.
Map Â Reduce Â (33 Â of Â 44)MapReduce Â Architecture Â (8 Â of Â 8)
<bad, Â (2, Â 1)>
<ending, Â 1>
...
<a, Â (1, Â 1)>
<news, Â 1>
...
<bad, Â 3>
<ending, Â 
1>
...
<a, Â 2>
<news, Â 1>
...
	 Â 
	 Â 
Back	 Â to	 Â Parallel	 Â Databases
Map Â Reduce Â (34 Â of Â 44)Back Â to Â Parallel Â Databases Â (0 Â of Â 2)
	 Â 
	 Â 
â€¢ Scenario	 Â 1:	 Â Semi-Â­â€Structured	 Â Data
â€¢ The	 Â data	 Â model	 Â of	 Â MapReduce use	 Â â€œkey-Â­â€value	 Â pairâ€	 Â data.
â€¢ Scenario	 Â 2	 Â &	 Â 3:	 Â ETL	 Â Tasks	 Â and	 Â Data	 Â Mining	 Â 
Applications
â€¢ Fast	 Â data	 Â loading	 Â time.
â€¢ Flexible	 Â User-Â­â€defined	 Â map()	 Â and	 Â reduce()	 Â functions	 Â in	 Â 
MapReduce.
Scenarios	 Â where	 Â MapReduce outperforms	 Â Parallel	 Â 
Databases
Map	 Â Reduce	 Â (35	 Â of	 Â 44)Back	 Â to	 Â Parallel	 Â Databases	 Â (1	 Â of	 Â 2)
	 Â 
How	 Â does	 Â the	 Â framework	 Â help	 Â us	 Â in	 Â these	 Â 
various	 Â scenarios?	 Â 
1.Data	 Â is	 Â not	 Â rigorous	 Â as	 Â tables.	 Â 	 Â 
Example:	 Â for	 Â image,	 Â key	 Â could	 Â be	 Â x,	 Â y	 Â 
coordinates	 Â and	 Â value	 Â could	 Â be	 Â image	 Â 
data.	 Â Key	 Â value	 Â could	 Â very	 Â simple	 Â and	 Â 
flexible	 Â 
2.	 Â ETL	 Â tasks	 Â and	 Â data	 Â mining	 Â can	 Â be	 Â done	 Â 
by	 Â map	 Â reduce	 Â because	 Â you	 Â simply	 Â 
provide	 Â map	 Â function	 Â &	 Â reduce	 Â function	 Â 
and	 Â write	 Â the	 Â logic	 Â in	 Â the	 Â framework	 Â 
Data	 Â loading:	 Â donâ€™t	 Â have	 Â to	 Â worry	 Â about	 Â 
schema,	 Â BCNF	 Â etc.	 Â A	 Â lot	 Â easier.	 Â 
â€¢ Scenario	 Â 4:	 Â Limited-Â­â€budget	 Â and	 Â Robust.
â€¢ Most	 Â MapReduce projects	 Â are	 Â open	 Â source	 Â and	 Â free.
â€¢ MapReduce supports	 Â mid-Â­â€query	 Â fault	 Â tolerance.
â€¢ If	 Â a	 Â node	 Â fails,	 Â the	 Â query	 Â does	 Â not	 Â need	 Â to	 Â be	 Â restarted.
â€¢ DBMSs	 Â typical	 Â donâ€™t	 Â support	 Â it.
â€¢ Only	 Â important	 Â as	 Â the	 Â number	 Â of	 Â nodes	 Â increases
â€¢ 1	 Â failure/month,	 Â 1	 Â hour/query
â€¢ Pr(mid_query_failure|10	 Â nodes)	 Â =	 Â 1%
â€¢ Pr(mid_query_failure|100	 Â nodes)	 Â =	 Â 13%
â€¢ Pr(mid_query_failure|1000	 Â nodes)	 Â =	 Â 75%
Scenarios	 Â where	 Â MapReduce outperforms	 Â 
Distributed	 Â Databases
Map	 Â Reduce	 Â (36	 Â of	 Â 44)Back	 Â to	 Â Parallel	 Â Databases	 Â (2	 Â of	 Â 2)
	 Â 
4.	 Â For	 Â robustness:	 Â 	 Â 
Example:	 Â suppose	 Â work	 Â counting	 Â is	 Â a	 Â 
query,	 Â it	 Â starts	 Â from	 Â reading	 Â documents,	 Â 
count	 Â words	 Â and	 Â sum	 Â up.	 Â It	 Â would	 Â be	 Â a	 Â 
long	 Â query.	 Â Then	 Â computer	 Â may	 Â crush	 Â 
when	 Â running	 Â it.	 Â Or	 Â nodes	 Â might	 Â not	 Â 
function	 Â well.	 Â Your	 Â partial	 Â result	 Â will	 Â be	 Â 
available	 Â to	 Â you.	 Â 	 Â 
	 Â 
If	 Â you	 Â are	 Â running	 Â this	 Â in	 Â database	 Â 
environment	 Â and	 Â the	 Â whole	 Â thing	 Â does	 Â 
not	 Â go	 Â through,	 Â then	 Â the	 Â whole	 Â thing	 Â will	 Â 
be	 Â erased	 Â and	 Â you	 Â canâ€™t	 Â get	 Â intermediate	 Â 
result	 Â and	 Â miss	 Â part	 Â of	 Â the	 Â result.	 Â Itâ€™s	 Â not	 Â 
good	 Â for	 Â this	 Â kind	 Â of	 Â workflow.	 Â 	 Â 
=>	 Â When	 Â running	 Â things	 Â on	 Â an	 Â unreliable	 Â 
cluster	 Â and	 Â the	 Â query	 Â is	 Â long,	 Â the	 Â chance	 Â 
of	 Â hardware	 Â failure	 Â is	 Â significant,	 Â Map-Â­â€
Reduce	 Â model	 Â helps	 Â us	 Â to	 Â pick	 Â up	 Â partial	 Â 
result	 Â 
Performance	 Â Comparison
Map Â Reduce Â (37 Â of Â 44)Performance Â Comparison Â (0 Â of Â 7)
	 Â 
	 Â 
â€¢ Goals
â€¢ Understand	 Â efficiency	 Â differences	 Â between	 Â MapReduce
and	 Â distributed	 Â databases
â€¢ Software
â€¢ MapReduce:	 Â Hadoop
â€¢ Distributed	 Â Databases:	 Â  DBMS-Â­â€X	 Â and	 Â Vertica
â€¢ Ran	 Â on	 Â 100	 Â node	 Â Linux	 Â cluster
â€¢ Dataset:	 Â Grep (used	 Â in	 Â original	 Â MapReduce paper,	 Â 
1TB	 Â of	 Â data)
Benchmark	 Â (Madden	 Â 2009)
Map	 Â Reduce	 Â (38	 Â of	 Â 44)Performance	 Â Comparison	 Â (1	 Â of	 Â 7)
	 Â 
Two	 Â underlying	 Â force	 Â that	 Â makes	 Â Map-Â­â€
Reduce	 Â a	 Â buzz	 Â word:	 Â 
-Â­â€	 Â Data	 Â is	 Â everywhere	 Â and	 Â most	 Â of	 Â them	 Â 
are	 Â non-Â­â€relational	 Â 
-Â­â€	 Â Cluster	 Â is	 Â everywhere	 Â 
Benchmark	 Â comparison	 Â between	 Â map-Â­â€
reduce	 Â Hadoop	 Â and	 Â distributed	 Â database	 Â 
DBMS-Â­â€X	 Â and	 Â Vertica.	 Â 
Extra	 Â resources	 Â of	 Â vertica:	 Â 
http://en.wikipedia.org/wiki/Vertica	 Â 
http://www.vertica.com/	 Â 
http://en.wikipedia.org/wiki/Michael_Sto
nebraker	 Â 
05000
10000
15000
20000
25000
30000
25*40GB 50*20GB 100*10GB
Ti
m
e	 Â 
(s
ec
on
ds
)
Hadoop
Vertica
DBMS-Â­â€X
Load	 Â Times
Map	 Â Reduce	 Â (39	 Â of	 Â 44)Performance	 Â Comparison	 Â (2	 Â of	 Â 7)
Databases	 Â donâ€™t	 Â scale	 Â linearly;	 Â Hadoop does
	 Â 
Hadoop	 Â wins	 Â on	 Â setup	 Â times	 Â significantly	 Â 
0
200
400
600
800
1000
1200
1400
1600
25*40GB 50*20GB 100*10GB
Ti
m
e	 Â 
(s
ec
on
ds
)
Hadoop
Vertica
DBMS-Â­â€X
Query	 Â Time
Map	 Â Reduce	 Â (40	 Â of	 Â 44)Performance	 Â Comparison	 Â (3	 Â of	 Â 7)
Verticaâ€™s compression	 Â works	 Â better	 Â than	 Â DBMS-Â­â€X
	 Â 
Vertica	 Â is	 Â the	 Â winner,	 Â Hadoop	 Â is	 Â the	 Â loser.	 Â 
0
200
400
600
800
1000
1200
1400
25*40GB 50*20GB 100*10GB
Ti
m
e	 Â 
(s
ec
on
ds
)
Hadoop
Vertica
DBMS-Â­â€X
Aggregation	 Â Task
Map	 Â Reduce	 Â (41	 Â of	 Â 44)Performance	 Â Comparison	 Â (4	 Â of	 Â 7)
DBMS	 Â perform	 Â better	 Â because	 Â 1.	 Â No	 Â parsing	 Â 
overheads;	 Â 2.	 Â Compression.
	 Â 
Vertica	 Â wins,	 Â Hadoop	 Â loses	 Â in	 Â 
aggregation.	 Â 
â€¢ Hadoop load	 Â times	 Â are	 Â faster
â€¢ Very	 Â important	 Â for	 Â one-Â­â€off	 Â processing	 Â tasks
â€¢ Hadoop Query	 Â and	 Â aggregation	 Â times	 Â are	 Â a	 Â lot	 Â 
slower.
â€¢ Parsing,	 Â compression	 Â and	 Â indexing	 Â in	 Â RDBMS
â€¢ No	 Â compelling	 Â reason	 Â to	 Â choose	 Â MapReduce over	 Â a	 Â 
database	 Â for	 Â traditional	 Â database	 Â workload.
Experimental	 Â Conclusion
Map	 Â Reduce	 Â (42	 Â of	 Â 44)Performance	 Â Comparison	 Â (5	 Â of	 Â 7)
	 Â 
-Â­â€	 Â Database	 Â is	 Â good	 Â for	 Â traditional	 Â 
database	 Â workload	 Â 
-Â­â€	 Â Map-Â­â€Reduce	 Â should	 Â only	 Â be	 Â chosen	 Â for	 Â 
unstructured	 Â data,	 Â complex	 Â processing,	 Â 
workflow	 Â â€“	 Â but	 Â you	 Â might	 Â find	 Â it	 Â hard	 Â to	 Â 
program	 Â 
-Â­â€	 Â There	 Â have	 Â been	 Â ongoing	 Â efforts	 Â to	 Â 
make	 Â the	 Â programming	 Â easier	 Â 
PigLatin	 Â â€“	 Â High	 Â level	 Â scripting	 Â language	 Â 
integrated	 Â with	 Â Hadoop	 Â to	 Â make	 Â 
programming	 Â easier.	 Â It	 Â abstracts	 Â the	 Â map-Â­â€
reduce	 Â and	 Â makes	 Â programming	 Â simpler	 Â 
	 Â 
-Â­â€	 Â Check	 Â out	 Â this	 Â video:	 Â 
msbiacademy.com/?p=6541	 Â 
(Itâ€™s	 Â done	 Â by	 Â Kevinâ€™s	 Â friend	 Â in	 Â Yahoo!)	 Â 
Hereâ€™s	 Â the	 Â brief	 Â introduction	 Â of	 Â it:	 Â 
â€œOne	 Â of	 Â the	 Â reasons	 Â to	 Â use	 Â Hadoop	 Â as	 Â 
part	 Â of	 Â your	 Â data	 Â warehouse	 Â strategy	 Â is	 Â to	 Â 
take	 Â advantage	 Â of	 Â its	 Â ability	 Â to	 Â process	 Â 
data	 Â in	 Â a	 Â distributed	 Â wayâ€“massively	 Â 
parallel	 Â processing,	 Â or	 Â MPP.	 Â 	 Â Another	 Â is	 Â to	 Â 
leverage	 Â its	 Â â€œschema	 Â on	 Â readâ€	 Â approach	 Â 
when	 Â processing	 Â unstructured	 Â data.	 Â 
In	 Â data	 Â warehousing	 Â terms,	 Â reading	 Â data	 Â 
from	 Â a	 Â source	 Â system	 Â is	 Â known	 Â as	 Â ETL,	 Â or	 Â 
â€œExtract/Transform/Loadâ€.	 Â 	 Â In	 Â MPP	 Â 
systems,	 Â itâ€™s	 Â typically	 Â more	 Â efficient	 Â to	 Â 
transpose	 Â the	 Â T	 Â and	 Â L	 Â letters	 Â and	 Â use	 Â the	 Â 
â€œExtract/Load/Transformâ€	 Â pattern.	 Â 	 Â Why?	 Â 
Because	 Â this	 Â pattern	 Â allows	 Â data	 Â 
transformation	 Â to	 Â leverage	 Â the	 Â full	 Â 
breadth	 Â of	 Â distributed	 Â processing	 Â nodes,	 Â 
resulting	 Â in	 Â superior	 Â performance.	 Â 
Pig,	 Â which	 Â is	 Â implements	 Â the	 Â PigLatin	 Â data	 Â 
flow	 Â language	 Â for	 Â Hadoop,	 Â is	 Â the	 Â most	 Â 
commonly	 Â used	 Â ELT	 Â technology	 Â in	 Â Hadoop	 Â 
clusters.	 Â In	 Â this	 Â introduction-Â­â€level	 Â lesson	 Â 
weâ€™ll	 Â look	 Â at	 Â a	 Â simple	 Â Pig	 Â script	 Â to	 Â process	 Â 
and	 Â transform	 Â IIS	 Â web	 Â logs.	 Â 	 Â While	 Â this	 Â is	 Â 
shown	 Â on	 Â an	 Â HDInsight	 Â cluster	 Â within	 Â the	 Â 
Azure	 Â cloud	 Â platform,	 Â the	 Â process	 Â is	 Â 
identical	 Â for	 Â any	 Â Hadoop	 Â cluster.â€œ	 Â 
	 Â 
	 Â 
The	 Â Future	 Â of	 Â MapReduce and	 Â Parallel	 Â Database:	 Â 
Friend	 Â or	 Â Foe?
Map Â Reduce Â (43 Â of Â 44)Performance Â Comparison Â (6 Â of Â 7)
	 Â 
They	 Â have	 Â different	 Â target	 Â audiences,	 Â so	 Â 
they	 Â are	 Â neither	 Â a	 Â friends	 Â nor	 Â foes.	 Â 
We	 Â need	 Â different	 Â tools	 Â because	 Â of	 Â the	 Â 
diversity.	 Â 
	 Â 
â€¢ Supporting	 Â SQL	 Â queries	 Â over	 Â MapReduce
Framework.
â€¢ Hive,	 Â Pig,	 Â Scope,	 Â Dryad/Linq.
â€¢ Supporting	 Â MapReduce Functions	 Â in	 Â Parallel	 Â 
Databases.
â€¢ X	 Â Su,	 Â et	 Â al.:	 Â Oracle	 Â in-Â­â€database	 Â Hadoop,	 Â when	 Â 
MapReduce meets	 Â RDBMS.	 Â In	 Â SIGMOD	 Â 2012
Efforts	 Â Towards	 Â Integrating	 Â Parallel	 Â Databases	 Â and	 Â 
MapReduce
Map	 Â Reduce	 Â (44	 Â of	 Â 44)Performance	 Â Comparison	 Â (7	 Â of	 Â 7)
	 Â 
	 Â 
	 Â 
